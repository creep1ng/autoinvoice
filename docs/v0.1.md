
# Autoinvoice v0.1

## Overview
Autoinvoice is a rewrite of "Arte Invoice Processor" with a focus on SOLID principles and clean architecture.  
**v0.1 Goal:** Accept a PDF file via API, process it, and return the extracted information.

## Project Structure

```
app/
    main.py                # FastAPI entrypoint
    api/                   # Routers (e.g., upload endpoint)
    core/
        extractors/        # LLM connectors (openai.py, openrouter.py, etc.)
        schema/            # Pydantic models for requests/responses
        services/          # Business logic (PDF processing, extraction)
        storage/           # File/database handling
    config.py              # Settings, env vars
tests/
    ...                    # Test files
```

## Flow Diagram

- User uploads PDF via API endpoint (`/upload`)
- File is stored (local or cloud)
- Service processes PDF (OCR if needed, chunking, etc.)
- Extractor sends data to LLM provider (OpenAI, OpenRouter, etc.)
- Extracted information is normalized and returned in API response

## Key Architectural Decisions (ADRs)

- **SOLID Principles:** Separation of concerns between API, business logic, and integrations.
- **Dependency Injection:** Use FastAPIâ€™s `Depends` for testability and modularity.
- **ORM:** Use SQLAlchemy for CRUD operations and migrations.
- **Error Handling:** Log errors, return meaningful API responses, and store failed jobs for retry.

For a general diagram, see [docs/BPMN.drawio](docs/BPMN.drawio)

## API Endpoints

| Endpoint      | Method | Description                |
|---------------|--------|----------------------------|
| /upload       | POST   | Upload PDF, returns result |

## Example Request/Response

**Request:**  
`POST /upload`  
Content-Type: multipart/form-data  
Body: base64-encoded PDF file

**Response:**  
```json
{
  "status": "success",
  "data": {
    "invoice_number": "...",
    "date": "...",
    "amount": "..."
    // ...other extracted fields
  }
}
```

## Testing

- Unit tests for extractors, services, and API endpoints
- Use mocks for LLM providers and file storage

## Next Steps

- Add support for more extractors/providers
- Implement background worker for failed jobs
- Expand error handling and logging
        